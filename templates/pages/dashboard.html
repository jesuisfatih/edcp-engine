{% extends "layout.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="page-header">
    <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
</div>

<!-- Stats Row -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="stat-card bg-primary">
            <h3 id="stat-total">0</h3>
            <p>Toplam Ürün</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card bg-success">
            <h3 id="stat-created">0</h3>
            <p>Oluşturulan</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card bg-warning">
            <h3 id="stat-updated">0</h3>
            <p>Güncellenen</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card bg-danger">
            <h3 id="stat-errors">0</h3>
            <p>Hatalar</p>
        </div>
    </div>
</div>

<!-- Last Sync Status -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-history"></i> Son Aktarım Durumu</h5>
    </div>
    <div class="card-body">
        <div id="dashboard-status">
            <p class="text-muted">Henüz aktarım yapılmadı</p>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-bolt"></i> Hızlı İşlemler</h5>
    </div>
    <div class="card-body">
        <div class="d-flex gap-2 flex-wrap">
            <a href="{{ url_for('page_sync') }}" class="btn btn-primary">
                <i class="fas fa-play"></i> Aktarım Başlat
            </a>
            <a href="{{ url_for('page_product_search') }}" class="btn btn-outline-primary">
                <i class="fas fa-search"></i> Ürün Ara
            </a>
            <a href="{{ url_for('page_settings') }}" class="btn btn-outline-secondary">
                <i class="fas fa-cog"></i> Ayarlar
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardStats();
});

async function loadDashboardStats() {
    try {
        const response = await fetch('/api/sync/status');
        const data = await response.json();
        
        if (data.status === 'success' && data.last_sync) {
            const stats = data.last_sync;
            document.getElementById('stat-total').textContent = stats.total || 0;
            document.getElementById('stat-created').textContent = stats.created || 0;
            document.getElementById('stat-updated').textContent = stats.updated || 0;
            document.getElementById('stat-errors').textContent = stats.errors || 0;
            
            document.getElementById('dashboard-status').innerHTML = `
                <div class="alert alert-${stats.errors > 0 ? 'warning' : 'success'}">
                    <strong>Son Aktarım:</strong> ${stats.total || 0} ürün işlendi, 
                    ${stats.created || 0} oluşturuldu, ${stats.updated || 0} güncellendi
                    ${stats.errors > 0 ? `, ${stats.errors} hata` : ''}
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading dashboard stats:', error);
    }
}
</script>
{% endblock %}

